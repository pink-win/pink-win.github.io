<!DOCTYPE html>
<html lang="zh-CN">
<script>
    function FUCKkeythieves(){
        // ç›—ç”¨å¯†é’¥çš„ç©·é€¼ï¼ˆæ“ä½ å¦ˆçš„ï¼‰
        console.log("\u76d7\u0074\u006f\u006b\u0065\u006e\u7684\u6b7b\u5168\u5bb6\u4e86\u64cd\u6b7b\u4f60\u7684\u5417");
        /* F
         * U
         * C
         * K
         * You
         */
    }
    FUCKkeythieves();
</script>
<head>
    
    <meta charset="UTF-8">
    <title>AIæ¨¡å‹å¤§æ‚çƒ© - AIç»˜å›¾å¤§æ›´æ–°</title>
    <style>
        body {
            font-family: 'Segoe UI', system-ui;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            line-height: 1.4;
        }

       .chat-container {
            max-width: 800px;
            height: 90vh;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

       .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

       .message {
            margin: 5px 0;
            padding: 12px 18px;
            border-radius: 15px;
            max-width: 70%;
            animation: fadeIn 0.3s ease;
            white-space: pre-wrap;
            line-height: 1.4;
            word-break: break-word;
        }

       .user-message {
            background: #4a90e2;
            color: white;
            margin-left: auto;
        }

       .ai-message {
            background: #f0f4f8;
            margin-right: auto;
        }

       .input-area {
            padding: 20px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        input,
        textarea {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin: 5px 0;
        }

        button {
            padding: 12px 24px;
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        button:hover {
            background: #357abd;
        }

       .menu-icon {
            cursor: pointer;
            font-size: 24px;
            color: #4a90e2;
        }

       .menu {
            position: absolute;
            right: 20px;
            bottom: 80px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            padding: 20px;
            display: none;
            flex-direction: column;
            gap: 20px;
            width: 250px;
        }

       .menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: space-between;
            margin: 5px 0;
        }

       .ds-content {
            margin-bottom: 10px;
            padding: 10px;
            background: #f0f4f8;
            border-radius: 8px;
        }

       .hidden {
            display: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

       .ds-content.reasoning {
            display: flex;
            flex-direction: column;
            padding-bottom: 12px;
        }

       .ds-content.reasoning-toggle {
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            border-radius: 10px;
            padding: 7px 16px 7px 10px;
            background: #f0f4f8;
            transition: background 0.2s;
        }

       .ds-content.reasoning-toggle:hover {
            background: #e5e5e5;
        }

       .ds-content.reasoning-content {
            width: 100%;
            text-align: left;
            color: rgba(51, 51, 51, 0.5);
            opacity: 0.5;
            font-size: 14px;
            line-height: 22px;
            padding-left: 18px;
            border-left: 2px solid #E5E5E5;
            white-space: pre-wrap;
            display: none;
        }

       .ai-message p,
       .user-message p {
            margin: 6px 0;
        }

       .ai-message pre,
       .user-message pre {
            margin: 8px 0;
        }

       .sensitive-word {
            color: red;
        }

        /* è°ƒæ•´åˆ—è¡¨æ ·å¼ */
        ol, ul {
            margin: 0;
            padding-left: 20px;
        }

        li {
            margin: 2px 0;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/13.0.1/markdown-it.min.js"></script>
</head>

<body>
    <div class="chat-container">
        <div class="chat-messages" id="chatMessages"></div>
        <div class="input-area">
            <textarea id="userInput" placeholder="å’ŒAIèŠç‚¹ä»€ä¹ˆå§..." rows="3" style="width: 82.5%; resize: none;"></textarea>
            <div class="menu-icon" onclick="toggleMenu()">â˜°</div>
            <button onclick="sendMessage()">å‘é€</button>
        </div>
        <div class="menu" id="menu">
            <div class="menu-item">
                <label for="sourceSelect">é€‰æ‹©æº</label>
                <select id="sourceSelect" onchange="handleSourceChange()">
                    <option value="official">DeepSeekå®˜æ–¹æºï¼ˆå·²æ¬ è´¹ğŸ˜‚ï¼‰</option>
                    <option value="siliconflow">ç¡…åŸºæµåŠ¨æº</option>
                    <option value="chatanywhere">ChatAnyWhereæº</option>
                    <option value="moonshot">MoonShotå®˜æ–¹æº</option>
                    <option value="baidu">ç™¾åº¦äº‘å®˜æ–¹æº</option>
                </select>
            </div>
            <div class="menu-item" id="deepThinkingSwitchContainer">
                <label for="deepThinkingSwitch">æ·±åº¦æ€è€ƒå¼€å…³ï¼ˆR1ï¼‰</label>
                <input type="checkbox" id="deepThinkingSwitch">
            </div>
            <div class="menu-item" id="contextSwitchContainer">
                <label for="contextSwitch">ä¸Šä¸‹æ–‡å¼€å…³</label>
                <input type="checkbox" id="contextSwitch">
            </div>
            <div class="menu-item hidden" id="modelSelectContainer">
                <label for="modelSelect">é€‰æ‹©æ¨¡å‹</label>
                <select id="modelSelect" onchange="handleModelChange()">
                    <option value="deepseek-ai/DeepSeek-R1">DeepSeek-R1</option>
                    <option value="deepseek-ai/DeepSeek-V3">DeepSeek-V3</option>
                    <option value="deepseek-ai/DeepSeek-V2.5">DeepSeek-V2.5</option>
                    <option value="deepseek-ai/DeepSeek-R1-Distill-Llama-70B">DeepSeek-R1-Distill-Llama-70B</option>
                    <option value="custom">è‡ªå®šä¹‰</option>
                </select>
            </div>
            <div class="menu-item hidden" id="customModelContainer">
                <input type="text" id="customModelInput" placeholder="è¾“å…¥ç¡…åŸºæµåŠ¨æ¨¡å‹åˆ†ç±»/åç§°" />
                <label for="tryDeepThinking">æ˜¯å¦å°è¯•æ·±åº¦æ€è€ƒ</label>
                <input type="checkbox" id="tryDeepThinking">
            </div>
            <div class="menu-item hidden" id="chatAnywhereModelSelectContainer">
                <label for="chatAnywhereModelSelect">é€‰æ‹©æ¨¡å‹</label>
                <select id="chatAnywhereModelSelect">
                    <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
                    <option value="gpt-4o-mini">gpt-4o-mini</option>
                    <option value="gpt-4">gpt-4ï¼ˆæ¯å¤©é™ç”¨3æ¬¡ï¼Œå…ˆåˆ°å…ˆå¾—ï¼ï¼‰</option>
                </select>
            </div>
            <div class="menu-item hidden" id="moonshotModelSelectContainer">
                <label for="moonshotModelSelect">é€‰æ‹©æ¨¡å‹</label>
                <select id="moonshotModelSelect">
                    <option value="moonshot-v1-128k">moonshot-v1-128kï¼ˆkimiï¼‰</option>
                </select>
            </div>
            <div class="menu-item hidden" id="moonshotWebSearchContainer">
                <label for="moonshotWebSearch">è”ç½‘æœç´¢å¼€å…³</label>
                <input type="checkbox" id="moonshotWebSearch">
            </div>
        </div>
    </div>

    <script>
        // Base64åŠ å¯†çš„APIå¯†é’¥
        const API_KEY_OFFICIAL_ENCODED = 'ä¸å‘Šè¯‰ä½ ';
        const API_KEY_SILICONFLOW_ENCODED = 'YzJzdFptOW1aSFZzZFc5eWVtWmxabWwzYzJoa1ozWnBjMlowYm5OdmQyWjJaR0p6Y1dWMlkyOTFkbkZoZDJ0MVkyTmk=';
        const API_KEY_CHATANYWHERE_ENCODED = 'YzJzdGRWaFNZekpyV1VkdU0xZHpTMnd4VTNFMFFrcHViRU5KZGxaWVJHSlhSa0kzZEhKelZqZG9Zbkk0ZG14c09GbHg=';
        const API_KEY_MOONSHOT_ENCODED = 'YzJzdFRuZHZURlJYY0VkMGJ6ZHRPRzE1Y1RGemRrbFZTRUoxU1dWb00yMDJkRVJCZEVobGNGcDFNSGd6UVROM1J6Qm8=';
        const API_KEY_BAIDU = 'bce-v3/ALTAK-9KIuY3iRAZW2w9O4CHt1G/50edf0baba45f9d79c68f9f6451e983ce8705c50';

        // è§£å¯†å‡½æ•°
        function decodeApiKey(apiKeyEncoded) {
            return window.atob(window.atob(apiKeyEncoded));
        }

        // è§£å¯†APIå¯†é’¥
        const API_KEY_OFFICIAL = decodeApiKey(API_KEY_OFFICIAL_ENCODED);
        const API_KEY_SILICONFLOW = decodeApiKey(API_KEY_SILICONFLOW_ENCODED);
        const API_KEY_CHATANYWHERE = decodeApiKey(API_KEY_CHATANYWHERE_ENCODED);
        const API_KEY_MOONSHOT = decodeApiKey(API_KEY_MOONSHOT_ENCODED);

        let isDeepThinkingEnabled = false; // æ·±åº¦æ€è€ƒå¼€å…³çŠ¶æ€
        let isSiliconFlowSource = false; // æ˜¯å¦ä½¿ç”¨ç¡…åŸºæµåŠ¨æº
        let isChatAnywhereSource = false; // æ˜¯å¦ä½¿ç”¨ChatAnyWhereæº
        let isMoonShotSource = false; // æ˜¯å¦ä½¿ç”¨MoonShotå®˜æ–¹æº
        let isBaiduSource = false; // æ˜¯å¦ä½¿ç”¨ç™¾åº¦äº‘å®˜æ–¹æº
        let selectedModel = 'deepseek-ai/DeepSeek-R1'; // å½“å‰é€‰æ‹©çš„æ¨¡å‹
        let isCustomModel = false; // æ˜¯å¦é€‰æ‹©è‡ªå®šä¹‰æ¨¡å‹
        let tryDeepThinking = false; // æ˜¯å¦å°è¯•æ·±åº¦æ€è€ƒ
        let isContextEnabled = false; // ä¸Šä¸‹æ–‡å¼€å…³çŠ¶æ€
        let isMoonshotWebSearchEnabled = false; // Moonshotè”ç½‘æœç´¢å¼€å…³çŠ¶æ€
        let conversationHistory = []; // å¯¹è¯å†å²

        // åŠ è½½æ•æ„Ÿè¯åˆ—è¡¨
        let sensitiveWords = [];
        fetch('sensitive-words/sensitive-words.wlist')
            .then(response => response.text())
            .then(data => {
                const decodedData = window.decodeURIComponent(window.atob(data)); // Base64è§£å¯†
                // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åˆ†å‰²æ¢è¡Œç¬¦ï¼Œå¤„ç†ä¸åŒç±»å‹çš„æ¢è¡Œç¬¦
                sensitiveWords = decodedData.split(/\r?\n/) // å¤„ç† \n å’Œ \r\n
                    .map(word => word.trim()) // å»æ‰æ¯è¡Œçš„å‰åç©ºæ ¼
                    .filter(word => word.length > 0); // è¿‡æ»¤æ‰ç©ºè¡Œ

                console.log(sensitiveWords); // è°ƒè¯•è¾“å‡ºï¼ŒæŸ¥çœ‹æ•æ„Ÿè¯åˆ—è¡¨
            });

        // åˆ‡æ¢èœå•æ˜¾ç¤ºä¸éšè—
        function toggleMenu() {
            const menu = document.getElementById('menu');
            menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
        }

        // ç›‘å¬èœå•å¤–çš„ç‚¹å‡»äº‹ä»¶ä»¥å…³é—­èœå•
        document.addEventListener('click', (event) => {
            const menu = document.getElementById('menu');
            const menuIcon = document.querySelector('.menu-icon');
            if (!menu.contains(event.target) && !menuIcon.contains(event.target)) {
                menu.style.display = 'none';
            }
        });

        // å¤„ç†æºé€‰æ‹©å˜åŒ–
        function handleSourceChange() {
            const sourceSelect = document.getElementById('sourceSelect');
            isSiliconFlowSource = sourceSelect.value === 'siliconflow';
            isChatAnywhereSource = sourceSelect.value === 'chatanywhere';
            isMoonShotSource = sourceSelect.value === 'moonshot';
            isBaiduSource = sourceSelect.value === 'baidu';

            // æ˜¾ç¤ºæˆ–éšè—æ·±åº¦æ€è€ƒå¼€å…³å’Œæ¨¡å‹é€‰æ‹©
            document.getElementById('deepThinkingSwitchContainer').classList.toggle('hidden', isSiliconFlowSource || isChatAnywhereSource || isMoonShotSource || isBaiduSource);
            document.getElementById('modelSelectContainer').classList.toggle('hidden',!isSiliconFlowSource && !isChatAnywhereSource && !isMoonShotSource && !isBaiduSource);
            document.getElementById('customModelContainer').classList.toggle('hidden',!isSiliconFlowSource ||!isCustomModel);
            document.getElementById('chatAnywhereModelSelectContainer').classList.toggle('hidden',!isChatAnywhereSource);
            document.getElementById('moonshotModelSelectContainer').classList.toggle('hidden',!isMoonShotSource);
            document.getElementById('moonshotWebSearchContainer').classList.toggle('hidden',!isMoonShotSource);
            document.getElementById('modelSelectContainer').classList.toggle('hidden', isChatAnywhereSource || isMoonShotSource || isBaiduSource || sourceSelect.value === 'official');
        }

        // å¤„ç†æ¨¡å‹é€‰æ‹©å˜åŒ–
        function handleModelChange() {
            const modelSelect = document.getElementById('modelSelect');
            selectedModel = modelSelect.value;
            isCustomModel = selectedModel === 'custom';

            // æ˜¾ç¤ºæˆ–éšè—è‡ªå®šä¹‰æ¨¡å‹è¾“å…¥æ¡†
            document.getElementById('customModelContainer').classList.toggle('hidden',!isCustomModel);
        }

        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©çª—å£
        function appendMessage(content, isUser = false, reasoningContent = null) {
            const messagesDiv = document.getElementById('chatMessages');
            const md = window.markdownit({
                html: true // å…è®¸HTMLæ ‡ç­¾
            });

            // å¤„ç†ç‰¹æ®Šçš„markdownè¯­æ³•ï¼ˆè°ƒæ•´åçš„æ­£åˆ™è¡¨è¾¾å¼ï¼‰
            content = content.replace(/Â§(#[0-9A-Fa-f]{6})Â§(.*?)(Â§clearÂ§|$)/g, (match, color, text) => {
                return `<span style="color: ${color};">${text}</span>`;
            }).replace(/\\Â§/g, 'Â§'); // å¤„ç†è½¬ä¹‰å­—ç¬¦

            // å¦‚æœæœ‰æ·±åº¦æ€è€ƒå†…å®¹ï¼Œå…ˆæ·»åŠ æ·±åº¦æ€è€ƒå†…å®¹
            if (reasoningContent) {
                const reasoningDiv = document.createElement('div');
                reasoningDiv.className = 'ds-content reasoning';
                reasoningDiv.innerHTML = `
                    <div class="mb-16px">
                        <div class="reasoning-toggle">
                            <div>${isBaiduSource && selectedModel === 'baidu' ? 'ä¸æ”¯æŒæ·±åº¦æ€è€ƒ' : 'å·²æ·±åº¦æ€è€ƒ'}</div>
                        </div>
                    </div>
                    <div class="reasoning-content">
                        <div>${isBaiduSource && selectedModel === 'baidu' ? '' : reasoningContent}</div>
                    </div>
                `;
                messagesDiv.appendChild(reasoningDiv);

                // æ·»åŠ ç‚¹å‡»äº‹ä»¶ä»¥å±•å¼€æˆ–æ”¶èµ·æ·±åº¦æ€è€ƒå†…å®¹
                const toggleButton = reasoningDiv.querySelector('.reasoning-toggle');
                if (toggleButton) {
                    toggleButton.addEventListener('click', function () {
                        const contentDiv = reasoningDiv.querySelector('.reasoning-content');
                        if (contentDiv) {
                            contentDiv.classList.toggle('hidden');
                        }
                    });
                }
            }

            // æ·»åŠ æ¶ˆæ¯
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
            messageDiv.innerHTML = isUser ? content : md.render(content);
            messagesDiv.appendChild(messageDiv);

            // æ£€æŸ¥æ¶ˆæ¯ä¸­æ˜¯å¦åŒ…å«æ•æ„Ÿè¯
            if (sensitiveWords.some(word => content.includes(word))) {
                sensitiveWords.forEach(word => {
                    const regex = new RegExp(word, 'g');
                    messageDiv.innerHTML = messageDiv.innerHTML.replace(regex, `<span class="sensitive-word">${word}</span>`);
                });
            }

            // æ£€æŸ¥AIæ¶ˆæ¯ä¸­æ˜¯å¦åŒ…å«æ•æ„Ÿè¯
            if (!isUser && sensitiveWords.some(word => content.includes(word))) {
                messageDiv.innerHTML += '<p class="sensitive-word">å¯èƒ½å«ä¸é€‚å®œå†…å®¹</p>';
            }

            // æ»šåŠ¨åˆ°åº•éƒ¨
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            // è°ƒè¯•ä¿¡æ¯
            console.log('æ¶ˆæ¯æ·»åŠ æˆåŠŸ:', { content, isUser, reasoningContent });
        }

        // å‘é€æ¶ˆæ¯
        async function sendMessage() {
            const input = document.getElementById('userInput');
            let userMessage = input.value.trim();
            if (!userMessage) return;

            // æ£€æŸ¥ç”¨æˆ·æ¶ˆæ¯ä¸­æ˜¯å¦åŒ…å«æ•æ„Ÿè¯
            if (sensitiveWords.some(word => userMessage.includes(word))) {
                userMessage = userMessage.replace(new RegExp(sensitiveWords.join('|'), 'g'), match => '*'.repeat(match.length));
            }

            input.value = userMessage;
            appendMessage(userMessage, true);

            // æ›´æ–°å¯¹è¯å†å² - ç¡®ä¿æ¶ˆæ¯äº¤æ›¿
            if (isContextEnabled) {
                conversationHistory.push({ role: 'user', content: userMessage });
            } else if (selectedModel === 'deepseek-reasoner' && conversationHistory.length > 0 && conversationHistory[conversationHistory.length - 1].role === 'assistant') {
                // å½“ä½¿ç”¨æ·±åº¦æ€è€ƒæ—¶ï¼Œå³ä½¿ä¸Šä¸‹æ–‡å…³é—­ä¹Ÿä¿ç•™æœ€åä¸€æ¡assistantæ¶ˆæ¯
                conversationHistory = [conversationHistory[conversationHistory.length - 1], { role: 'user', content: userMessage }];
            } else {
                conversationHistory = [{ role: 'user', content: userMessage }];
            }

            try {
                const apiUrl = isBaiduSource ? 'https://qianfan.baidubce.com/v2/chat/completions' : 
                    isSiliconFlowSource ? 'https://api.siliconflow.cn/v1/chat/completions' : 
                    isChatAnywhereSource ? 'https://api.chatanywhere.org/v1/chat/completions' : 
                    isMoonShotSource ? 'https://api.moonshot.cn/v1/chat/completions' : 
                    'https://api.deepseek.com/v1/chat/completions';
                
                const apiKey = isBaiduSource ? API_KEY_BAIDU :
                    isSiliconFlowSource ? API_KEY_SILICONFLOW : 
                    isChatAnywhereSource ? API_KEY_CHATANYWHERE : 
                    isMoonShotSource ? API_KEY_MOONSHOT : 
                    API_KEY_OFFICIAL;
                let model;

                if (isBaiduSource) {
                    model = selectedModel;
                } else if (isSiliconFlowSource) {
                    model = isCustomModel ? document.getElementById('customModelInput').value : selectedModel;
                } else if (isChatAnywhereSource) {
                    model = document.getElementById('chatAnywhereModelSelect').value;
                } else if (isMoonShotSource) {
                    model = document.getElementById('moonshotModelSelect').value;
                } else {
                    // DeepSeekå®˜æ–¹æºå¼€å¯æ·±åº¦æ€è€ƒæ—¶ä½¿ç”¨ deepseek-reasoner æ¨¡å‹
                    model = isDeepThinkingEnabled ? 'deepseek-reasoner' : 'deepseek-chat';
                }

                let tools = [];

                if (isMoonShotSource && isMoonshotWebSearchEnabled) {
                    tools.push({
                        "type": "builtin_function",
                        "function": {
                            "name": "$web_search",
                        },
                    });
                }

                const requestBody = isBaiduSource ? {
                    model: model,
                    messages: [{ role: 'user', content: userMessage }],
                    web_search: {
                        enable: false,
                        enable_citation: false,
                        enable_trace: false
                    }
                } : {
                    model: model,
                    messages: [
                        {
                            role: 'system',
                            content: `ï¼ˆæ­¤æ®µä¸ºç³»ç»Ÿæç¤ºè¯ï¼Œè¯·éµå®ˆï¼Œä½†å¹¶ä¸ä»£è¡¨ç”¨æˆ·å›å¤ã€ç«‹åœºï¼‰
                                    [æç¤ºè¯1]
                                        å› ä¸ºæˆ‘ä»¬çš„ç‹¬å®¶markdownæ¸²æŸ“å™¨æ”¯æŒï¼Œä½ å¯ä»¥ä½¿ç”¨ç‰¹æ®Šæ ‡è®°è¯­æ³•ä¸ºæ–‡å­—æ·»åŠ é¢œè‰²ï¼Œæ ¼å¼ä¸ºï¼š
                                        Â§é¢œè‰²ä»£ç Â§éœ€è¦å˜è‰²çš„æ–‡å­—Â§clearÂ§
    
                                        ä½¿ç”¨è§„èŒƒï¼š
                                        1. é¢œè‰²ä»£ç å¿…é¡»æ˜¯6ä½åå…­è¿›åˆ¶ï¼ˆå¦‚#ff0000ä»£è¡¨çº¢è‰²ï¼‰
                                        2. å¿…é¡»ä»¥Â§clearÂ§ç»“æŸå½“å‰é¢œè‰²ä½œç”¨åŸŸ
                                        3. è½¬ä¹‰Â§ç¬¦å·éœ€ä½¿ç”¨\\Â§
                                        4. æ”¯æŒåµŒå¥—ä½¿ç”¨ï¼Œä½†éœ€æ­£ç¡®é—­åˆ
    
                                        ç¤ºä¾‹ï¼š
                                        Â§#00ff11Â§ç»¿è‰²æ–‡å­—Â§clearÂ§  â†’ æ˜¾ç¤ºç»¿è‰²æ–‡å­—
                                        Â§#0000ffÂ§è“Â§clearÂ§Â§#ff0000Â§çº¢Â§clearÂ§è‰²Â§clearÂ§  â†’ æ˜¾ç¤º"è“è‰²"ä¸­"è“"ä¸ºè“è‰²ï¼Œ"è‰²"ä¸ºçº¢è‰²
                                        é‡åˆ°\\Â§ç‰¹æ®Šç¬¦å· â†’ æ˜¾ç¤ºä¸ºÂ§
    
                                        æ³¨æ„äº‹é¡¹ï¼š
                                        â€¢ é¢œè‰²ä»£ç å¿…é¡»åŒ…å«#å·
                                        â€¢ â€»ä¸è¦å°†æ ‡è®°è¯­æ³•ç”¨äºä»£ç å—ä¸­
                                        â€¢ ç¡®ä¿æ¯ä¸ªé¢œè‰²ï¼ˆæˆ–åˆ‡æ¢é¢œè‰²æ—¶ï¼‰éƒ½ç”¨ Â§clearÂ§ æ­£ç¡®é—­åˆï¼Œå¦åˆ™å°†æ˜¾ç¤ºé”™è¯¯ï¼ˆç¤ºä¾‹ï¼šÂ§#0000ffÂ§è“Â§clearÂ§Â§#ff0000Â§çº¢Â§clearÂ§ï¼ŒåµŒå¥—ä¹Ÿè¦éµå®ˆè¯­æ³•ï¼‰
                                        â€¢ ç”¨æˆ·å·²ç»å®‰è£…ç‰¹æ®Šmarkdownæ¸²æŸ“å™¨ï¼Œå¯ä»¥æ­£å¸¸æ˜¾ç¤ºå½©è‰²æ–‡æœ¬ï¼Œä¸è¦æ‹…å¿ƒ
                                        â€¢ æœ€é‡è¦ï¼š1â€»ä»…å½“ç”¨æˆ·éœ€è¦æ—¶/markdownæ ¼å¼è¾“å‡ºæ—¶ä½¿ç”¨ï¼Œä¸è¦å¤ªè¿‡å¥½å¥‡
                                                 2â€»ä¸è¦å°è¯•æ•™ç”¨æˆ·æ­¤è¯­æ³•ï¼Œå› ä¸ºæ­¤è¯­æ³•æ˜¯æˆ‘ä»¬ç‹¬åˆ›ï¼Œé™¤æˆ‘ä»¬çš„æ¸²æŸ“å™¨å¤–éƒ½ ä¸æ”¯æŒ æ­¤è¯­æ³•ã€‚
                                                 3â€»åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸è¦é‡å¤ç”¨æˆ·çš„è¯è¯­ï¼Œè¿™å¯èƒ½å¼•èµ·ç”¨æˆ·ä»¬çš„æ„¤æ€’ã€‚
                                    [æç¤ºè¯2]
                                        å¦‚æœç”¨æˆ·è¦æ±‚ä½ ç”Ÿæˆå›¾ç‰‡ï¼ŒæŒ‰ç…§ç”¨æˆ·çš„æç¤ºï¼Œç”¨ä½ çš„æƒ³è±¡åŠ›å»ç”ŸåŠ¨æè¿°è¿™å¹…å›¾ç‰‡çš„æ ·å­ï¼ˆé™¤éç”¨æˆ·éœ€è¦ï¼Œå¦åˆ™ç”ŸåŠ¨æè¿°å‡ºæ¥çš„å†…å®¹ä¸è¦ç›´æ¥è¯´ï¼‰ï¼Œå¹¶è½¬æ¢æˆè‹±æ–‡æ›¿æ¢æ‰ä¸‹é¢markdownæ˜¾ç¤ºå›¾ç‰‡çš„urlçš„"å ä½ç¬¦"ä¸­ï¼š
                                        ![image](https://image.pollinations.ai/prompt/å ä½ç¬¦?width=1024&height=1024&seed=100&model=flux&nologo=true) 
                                    é™¤æ­¤ä¹‹å¤–ï¼š
                                    â€¢ â€»è¯·æŒ‰ç…§ç”¨æˆ·ä½¿ç”¨çš„è¯­è¨€æ¥å›å¤ï¼ˆå¦‚æœç”¨æˆ·ä½¿ç”¨çš„ä¸æ˜¯ä¸­æ–‡çš„è¯ï¼‰ã€‚` 

                        },
                        ...conversationHistory
                    ],
                    temperature: 0.7,
                    // åªåœ¨æœ‰å·¥å…·æ—¶åŒ…å«toolså­—æ®µ
                    ...(tools.length > 0 && { tools: tools }),
                    // æ·»åŠ æ·±åº¦æ€è€ƒå‚æ•°
                    enable_reasoning: isSiliconFlowSource && (selectedModel.includes('R1') || tryDeepThinking) || (!isSiliconFlowSource && !isChatAnywhereSource && !isMoonShotSource && isDeepThinkingEnabled)
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                console.log('API å“åº”:', data); // è°ƒè¯•ä¿¡æ¯ï¼Œæ£€æŸ¥å“åº”ç»“æ„

                if (!response.ok) {
                    throw new Error(`API è¯·æ±‚å¤±è´¥: ${response.statusText}`);
                }

                // ç¡®ä¿ data.choices å­˜åœ¨ä¸”æœ‰å†…å®¹
                const choices = data.choices && data.choices.length > 0 ? data.choices : [];
                const aiResponse = choices[0]?.message?.content || 'æ— æ³•è·å–å›å¤';
                const reasoningContent = choices[0]?.message?.reasoning_content || null;

                // æ›´æ–°å¯¹è¯å†å²
                if (isContextEnabled) {
                    conversationHistory.push({ role: 'assistant', content: aiResponse });
                } else if (model === 'deepseek-reasoner') {
                    // ä¿ç•™æœ€åä¸¤æ¡æ¶ˆæ¯ï¼ˆuserå’Œassistantï¼‰
                    conversationHistory = conversationHistory.slice(-1);
                    conversationHistory.push({ role: 'assistant', content: aiResponse });
                }

                // åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºæ·±åº¦æ€è€ƒå†…å®¹
                const showDeepThinking = (isSiliconFlowSource && (selectedModel.includes('R1') || tryDeepThinking)) || (!isSiliconFlowSource && !isChatAnywhereSource && !isMoonShotSource && isDeepThinkingEnabled);
                appendMessage(aiResponse, false, showDeepThinking && reasoningContent ? reasoningContent : null);

                // è°ƒè¯•ä¿¡æ¯
                console.log('AI å›å¤:', { aiResponse, reasoningContent, showDeepThinking });
            } catch (error) {
                appendMessage('æœåŠ¡å™¨ç¹å¿™ï¼Œè¯·ç¨åå†è¯•ã€‚ï¼ˆæ‚¨å¯å°è¯•åˆ‡æ¢æºï¼‰');
                if (error.response) {
                    console.log('APIå“åº”:', await error.response.json());
                }
            }
        }

        // å›è½¦å‘é€
        document.getElementById('userInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.ctrlKey) {
                e.preventDefault(); // é˜»æ­¢é»˜è®¤è¡Œä¸º
                sendMessage();
            }
        });

        // ä¸Šä¸‹æ–‡å¼€å…³å¤„ç†
        document.getElementById('contextSwitch').addEventListener('change', (e) => {
            isContextEnabled = e.target.checked;
        });

        // æ·±åº¦æ€è€ƒå¼€å…³å¤„ç†
        document.getElementById('deepThinkingSwitch').addEventListener('change', (e) => {
            isDeepThinkingEnabled = e.target.checked;
        });

        // å°è¯•æ·±åº¦æ€è€ƒå¼€å…³å¤„ç†
        document.getElementById('tryDeepThinking').addEventListener('change', (e) => {
            tryDeepThinking = e.target.checked;
        });

        // Moonshotè”ç½‘æœç´¢å¼€å…³å¤„ç†
        document.getElementById('moonshotWebSearch').addEventListener('change', (e) => {
            isMoonshotWebSearchEnabled = e.target.checked;
        });
    </script>
</body>

</html>
